---
title: "An√°lisis de varianza de una v√≠a"
author: "Fabi√°n Gil"
date: "`r Sys.Date()`"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: false
    df_print: default
runtime: shiny_prerendered
description: >
  An√°lisis de varianza de una v√≠a y pruebas post hoc.
editor_options: 
  markdown: 
    wrap: 72
---

```{r banner, echo=FALSE, results='asis'}
htmltools::HTML("
  <div style='
    text-align: center;
    margin-bottom: 20px;
  '>
    <img src='images/banner_central.png' style='
      max-width: 100%;
      height: auto;
    '>
  </div>
")
```
  
```{r, echo=FALSE, results='asis'}
htmltools::tags$style(HTML("
  h1 {
    color: #1e90ff; /* Azul para t√≠tulos principales */
  }

  h2 {
    color: #007bff; /* Azul brillante para subt√≠tulos */
  }

  h3 {
    color: #0056b3; /* Azul m√°s oscuro para subt√≠tulos m√°s peque√±os */
  }
"))
```


```{r setup, include=FALSE}
# Attach packages:

library(learnr)
library(fontawesome)
library(ggplot2)
library(car)

# Global code chunk settings:
knitr::opts_chunk$set(echo = FALSE)

# data

```

## 1. Introducci√≥n


```{r, echo=FALSE, out.width="100%", fig.align = "center"}
knitr::include_graphics("images/banner1e.png")  
```

<div class="alert alert-info" role="alert">
Este tutorial interactivo le permitir√° aplicar los conceptos fundamentales del <strong> an√°lisis de varianza (ANOVA) de una v√≠a </strong> mediante la ejecuci√≥n de c√≥digo en R. A trav√©s de ejemplos guiados y ejercicios pr√°cticos, usted desarrollar√° habilidades para calcular e interpretar pruebas de hip√≥tesis para comprara las medias de tres o m√°s grupos independientes, verificar los supuesto del ANOVA y realizar pruebas post hoc si el ANOVA es estad√≠sticamente significativo. Estas herramientas son fundamental en investigaci√≥n cl√≠nica y epidemiol√≥gica para evaluar la eficacia de m√∫ltiples tratamientos, intervenciones o exposiciones, asegurando una evaluaci√≥n estad√≠sticamente robusta sin aumentar el error tipo I como ocurrir√≠a con m√∫ltiples pruebas t independientes.
</div>


<h3>Cr√©ditos</h3>

<p><strong>Autor:</strong> Fabi√°n Gil</p>
<p><strong>Afiliaci√≥n:</strong> Departamento de Epidemiolog√≠a Cl√≠nica y Bioestad√≠stica, Facultad de Medicina. Pontificia Universidad Javeriana</p>
<p><strong>Contacto:</strong> <a href="mailto:fgil@javeriana.edu.co">fgil@javeriana.edu.co</a></p>

<p>Este tutorial ha sido desarrollado como parte del curso de <em>Introducci√≥n a la Bioestad√≠stica en la Maestr√≠a en Epidemiolog√≠a Cl√≠nica</em>.</p>


<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"><img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" alt="Licencia de Creative Commons" style="border-width:0"/></a><br />Esta
obra est√° bajo una
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">licencia
de Creative Commons Reconocimiento-NoComercial-CompartirIgual 4.0
Internacional</a>.

## 1.1 Descripci√≥n del taller

Este taller interactivo introduce el uso del an√°lisis de varianza (ANOVA) de una v√≠a y las pruebas post hoc aplicadas en contextos cl√≠nicos y epidemiol√≥gicos. A trav√©s de ejemplos pr√°cticos en R y actividades guiadas, el enfa√≠s estar√° en:

- Comparar medias entre varios grupos independientes.

- Verificar los supuestos del ANOVA.

- Interpretar correctamente los resultados estad√≠sticos.

- Aplicar pruebas post hoc como Tukey HSD cuando sea necesario.


## 1.2 Temas que abordaremos:

- Introducci√≥n al ANOVA de una v√≠a

- Supuestos del ANOVA

- Aplicaci√≥n pr√°ctica en R

- Pruebas post hoc


## 1.3 ¬øC√≥mo desarrollar este tutorial?

A lo largo del tutorial, encontrar√° ejemplos de c√≥digo, ejercicios de
programaci√≥n y preguntas de an√°lisis. Los ejemplos de c√≥digo y los
ejercicios pretenden introducir habilidades b√°sicas de R. No es
necesario tener conocimientos previos sobre R para el desarrollo de este
tutorial.

#### `r fa("lightbulb", fill = "orange",  height="2em", width="2em")` = Ejemplo de c√≥digo

Este √≠cono identifica ejemplos de c√≥digo listos para usar. Es posible explorar, ejecutar y modificar este c√≥digo para comprender el funcionamiento de cada funci√≥n o comando. Para ejecutar el c√≥digo, solo es necesario presionar el bot√≥n **Run code** en la esquina superior derecha.


```{r, echo=FALSE, out.width="100%", fig.align = "center"}
knitr::include_graphics("images/ejemplo.png")  
```

> **No es necesario preocuparse por ‚Äúda√±ar‚Äù el c√≥digo:** si se realizan modificaciones que generan errores, el ejemplo original puede restaurarse en cualquier momento mediante el bot√≥n **Start Over** en la esquina superior izquierda.


#### `r fa("pencil-alt", fill = "green", height="2em", width="2em")` = Ejercicio de c√≥digo

Los ejercicios est√°n dise√±ados para aplicar lo aprendido, escribiendo el c√≥digo necesario para resolver las preguntas o problemas planteados.

> **Si siente que se ha quedado sin ideas o no sabe c√≥mo continuar con el ejercicio:** puede consultar el bot√≥n **Solution** (soluci√≥n) para recibir orientaci√≥n sin perder la oportunidad de aprender activamente.

```{r, echo=FALSE, out.width="100%", fig.align = "center"}
knitr::include_graphics("images/ejercicio.png")  
```

#### `r fa("comments", fill = "#2c5697", height="2em", width="2em")` = Preguntas de an√°lisis

Estas preguntas invitan a reflexionar sobre los resultados y conceptos. Algunas no poseen una √∫nica respuesta correcta, sino que buscan fomentar el pensamiento cr√≠tico.

Con frecuencia, estas preguntas est√°n vinculadas con un ejemplo o ejercicio
de c√≥digo. En esos casos, aseg√∫rese de ejecutar el c√≥digo
correspondiente para poder ver la salida necesaria que le ayudar√° a
responder las preguntas.

## 2. Introducci√≥n a ANOVA de una v√≠a

El an√°lisis de varianza de una v√≠a (ANOVA one-way) es una prueba estad√≠stica que permite comparar las medias de tres o m√°s grupos independientes para determinar si al menos una de ellas difiere estad√≠sticamente significa del resto.

A diferencia de realizar m√∫ltiples pruebas t independientes (lo cual aumenta el riesgo de error tipo I), el ANOVA eval√∫a todas las comparaciones en un solo modelo, controlando adecuadamente la probabilidad de falsos positivos.

El ANOVA de una v√≠a se aplica cuando se tiene una variable cuantitativa continua (ej. colesterol, d√≠as de hospitalizaci√≥n, nivel de glucosa) y se desea comparar esa variable entre tres o m√°s grupos independientes definidos por una variable categ√≥rica (ej. tipo de tratamiento, grupo etario, nivel de exposici√≥n).

El ANOVA de una v√≠a es una **importante metodolog√≠a en el an√°lisis de estudios cl√≠nicos y epidemiol√≥gicos** para:

* Comparar la eficacia de m√∫ltiples tratamientos o intervenciones, por ejemplo, para reducir s√≠ntomas o biomarcadores.

* Evaluar diferencias entre grupos poblacionales seg√∫n factores como edad, nivel socioecon√≥mico, comorbilidades, entre otros.

* Evitar errores estad√≠sticos asociados a m√∫ltiples comparaciones con m√∫ltiples pruebas t.

Adem√°s, su aplicaci√≥n adecuada permite tomar decisiones basadas en evidencia, contribuyendo a la validez cient√≠fica de los hallazgos cl√≠nicos.

## 2.1 Supuestos del ANOVA

üìå 1. Independencia de las observaciones

> Cada observaci√≥n debe ser independiente de las dem√°s, es decir, que la medici√≥n de un individuo no debe influir en la de otro.

**¬øC√≥mo se asegura?**
A trav√©s del dise√±o del estudio (por ejemplo, asignaci√≥n aleatoria o muestreo adecuado). No se prueba estad√≠sticamente: se asume si el dise√±o es correcto.

**¬øPor qu√© importa?**
La falta de independencia (como en estudios con datos pareados o repetidos) puede invalidar el an√°lisis y requerir modelos m√°s complejos (ej. ANOVA de medidas repetidas o modelos mixtos).

üìå 2. Normalidad de los residuales

> Los residuales del modelo (diferencias entre los valores observados y los esperados por el ANOVA) deben seguir una distribuci√≥n normal.

**¬øC√≥mo se verifica?**
Mediante:

Gr√°ficos (histograma, Q-Q plot)

Pruebas estad√≠sticas (como Shapiro-Wilk)

**¬øPor qu√© importa?**
Si los residuales no son normales y el tama√±o muestral es peque√±o, los resultados del ANOVA pueden no ser v√°lidos. En muestras grandes, ANOVA es robusto a cierta desviaci√≥n de la normalidad.

üìå 3. Homogeneidad de varianzas (homocedasticidad)

> La varianza de la variable dependiente debe ser similar en todos los grupos.

**¬øC√≥mo se verifica?**
Con pruebas como:

Prueba de Levene

Prueba de Bartlett (menos robusta si no hay normalidad)

**¬øPor qu√© importa?**
Si las varianzas son muy diferentes, el ANOVA puede dar resultados enga√±osos. En ese caso, se pueden usar alternativas como:

ANOVA de Welch

Transformaciones

Pruebas no param√©tricas (Kruskal-Wallis)

‚úÖ Resumen
### ‚úÖ Resumen de los supuestos del ANOVA

| Supuesto                  | C√≥mo se eval√∫a                          | Qu√© hacer si no se cumple                          |
|--------------------------|------------------------------------------|----------------------------------------------------|
| Independencia            | Dise√±o del estudio                       | Usar modelos mixtos o dise√±os emparejados          |
| Normalidad de residuos   | Prueba de Shapiro-Wilk, gr√°ficos Q-Q     | Transformar datos o usar ANOVA robusto             |
| Homogeneidad de varianzas| Prueba de Levene                         | Usar Welch ANOVA o prueba no param√©trica (Kruskal-Wallis) |


## 2.1 hip√≥tesis del ANOVA

- $$ H_0: \mu_1 = \mu_2 = \mu_3 = \dots = \mu_k$$

- $$ H_a: \exists\, i, j \; \text{tal que} \; \mu_i \neq \mu_j $$


## Pregunta de an√°lisis 2.1

##### `r fa("comments", fill = "#2c5697")` An√°lisis 2.1

```{r quiz_2_1}
quiz(
  question("¬øCu√°l es la hip√≥tesis nula en un ANOVA de una v√≠a?",
  answer("Todas las medias son iguales", correct = TRUE),
  answer("Todas las varianzas son iguales", correct = FALSE),
  answer("Las medias son diferentes entre todos los grupos", correct = FALSE),
  answer("La variable dependiente no es normal", correct = FALSE),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question("¬øCu√°l de los siguientes es un supuesto del ANOVA?",
  answer("Normalidad de los residuos", correct = TRUE),
  answer("Igual n√∫mero de observaciones por grupo", correct = FALSE),
  answer("Linealidad entre variables", correct = FALSE),
  answer("Correlaci√≥n alta entre variables", correct = FALSE),
  allow_retry = TRUE,
  random_answer_order = TRUE
),
question("¬øQu√© supuesto del ANOVA se eval√∫a con la prueba de Shapiro-Wilk?",
    answer("Independencia de las observaciones", correct = FALSE),
    answer("Normalidad de los residuos", correct = TRUE),
    answer("Homogeneidad de varianzas", correct = FALSE),
    answer("Linealidad de la relaci√≥n entre variables", correct = FALSE),
    allow_retry = TRUE,
    random_answer_order = TRUE
  )
)
```

## 3. Exploraci√≥n de datos y verificaci√≥n de supuestos

Se emplear√°n los datos (simulados) que contiene los niveles de colesterol (mg/dL) de pacientes asignados aleatoriamente a tres tipos de dieta: **A**, **B** y **C**

##### `r fa("lightbulb", fill = "orange")` Ejemplo 3.1

```{r gen_datos, exercise = TRUE, message=FALSE, warning=FALSE}
# Simulaci√≥n de datos
set.seed(123)  # Para reproducibilidad
datos <- data.frame(
dieta = rep(c("A", "B", "C"), times =c(10, 13, 12)),
colesterol = c(rnorm(10, 200, 10),  # Dieta A
                 rnorm(13, 190, 12),  # Dieta B
                 rnorm(12, 180, 15))  # Dieta C
)

head(datos)
```

##### `r fa("lightbulb", fill = "orange")` Ejemplo 3.2

```{r eje3_2,  exercise = TRUE, exercise.setup = "gen_datos"}
# Crear un boxplot para visualizar la distribuci√≥n de colesterol por dieta
boxplot(colesterol ~ dieta, data = datos,
        main = "Colesterol por tipo de dieta",
        ylab = "Colesterol",
        xlab = "Dieta")

```
  
üéØ Pregunta: ¬øObserva diferencias aparentes en las medianas o la dispersi√≥n de los grupos?


## 3.1 Verificaci√≥n del supuesto de normalidad

En ANOVA de una v√≠a, se asume que los residuales del modelo est√°n normalmente distribuidos. Dado que cada grupo tiene su propia media, esta suposici√≥n se traduce, de forma pr√°ctica, en que:

> Las observaciones dentro de cada grupo deben seguir aproximadamente una distribuci√≥n normal.

Verificaremos el supuesto de normalidad usando:

* Histogramas
* Gr√°fico Q-Q 
* Prueba de Shapiro-Wilk

##### `r fa("lightbulb", fill = "orange")` Ejemplo 3.3

Usaremos `ggplot2` para crear histogramas de la variable **colesterol** para cada tipo de dieta.

```{r ej3_3, exercise=TRUE, exercise.setup = "gen_datos"}
# Cargar librer√≠a
library(ggplot2)

# Crear un histograma para la variable 'colesterol' por cada tipo de dieta
ggplot(datos, aes(x = colesterol, fill = dieta)) + 
  geom_histogram(binwidth = 5, alpha = 0.6, position = "identity") +
  facet_wrap(~dieta, scales = "free_y") +
  theme_minimal() +
  labs(title = "Distribuci√≥n de Colesterol por Tipo de Dieta",
       x = "Colesterol (mg/dL)", y = "Frecuencia")
```

##### `r fa("lightbulb", fill = "orange")` Ejemplo 3.4

Usaremos `ggplot2` para crear gr√°ficos Q-Q para cada tipo de dieta.

```{r eje3_4, exercise=TRUE, exercise.setup = "gen_datos"}
# Cargar librer√≠a
library(ggplot2)

# Crear gr√°ficos Q-Q para la variable 'colesterol' por cada tipo de dieta
ggplot(datos, aes(sample = colesterol)) +
  stat_qq() +
  stat_qq_line() +
  facet_wrap(~ dieta) +
  labs(title = "QQ-plot por grupo de dieta")
```

##### `r fa("lightbulb", fill = "orange")` Ejemplo 3.5

Usaremos la prueba de Shapiro-Wilk para cada tipo de dieta.

```{r eje3_5, exercise=TRUE, exercise.setup = "gen_datos"}
# Calcular la prueba de Shapiro-Wilk por cada tipo de dieta
by(datos$colesterol, datos$dieta, shapiro.test)
```

üí° ¬øQu√© hacer si no se cumple el supuesto de normalidad?

Si los datos no son normales y el tama√±o de muestra es peque√±o, puedes:

- Aplicar transformaciones (log, ra√≠z cuadrada, Box-Cox).

- Usar pruebas no param√©tricas: como el test de Kruskal-Wallis.

- Verificar si la no normalidad afecta realmente los residuales del modelo (ver secci√≥n XXX de este tutorial).

## 3.2 Verificaci√≥n del supuesto de homogeneidad de varianzas

El ANOVA de una v√≠a tambi√©n asume que las varianzas de los grupos son homog√©neas (homocedasticidad). Esto significa que la variabilidad de la variable dependiente es similar en todos los grupos.

Para verificar este supuesto, utilizaremos:
* Gr√°ficos de caja (boxplots)
* Prueba de Levene (m√°s robusta a la no normalidad)
* Prueba de Bartlett (m√°s potente, pero sensible a no normalidad) 

##### `r fa("lightbulb", fill = "orange")` Ejemplo 3.6


## 3.2.1 Evaluaci√≥n gr√°fica

Usaremos `boxplot` para crear gr√°ficos Q-Q para cada tipo de dieta.

```{r eje3_6, exercise=TRUE, exercise.setup = "gen_datos"}
# Crear un boxplot para visualizar la homogeneidad de varianzas

boxplot(colesterol ~ dieta, data = datos,
        main = "Colesterol por tipo de dieta",
        ylab = "Colesterol",
        xlab = "Dieta")
```


## 3.2.1 prueba de Levene  

El ANOVA asume que la varianza de la variable dependiente (colesterol) es igual en todos los grupos.

Es decir:
$$H_0: \sigma^2_A = \sigma^2_B = \sigma^2_C$$

$$H_1: \text{Al menos una varianza es diferente}$$


##### `r fa("lightbulb", fill = "orange")` Ejemplo 3.7

Usaremos la funci√≥n `leveneTest` del paquete `car`

```{r eje3_7, exercise=TRUE, exercise.setup = "gen_datos"}
# Prueba de hip√≥tesis de Levene

library(car)
leveneTest(colesterol ~ factor(dieta), data = datos)

# factor(dieta) cosidera cada dieta como un grupo
```


## 3.2.2 prueba de Bartlett

Emplea el mismo conjunto de hip√≥tesis de la prueba de Levene

##### `r fa("lightbulb", fill = "orange")` Ejemplo 3.7

Usaremos la funci√≥n `bartlett.test`

```{r eje3_8, exercise=TRUE, exercise.setup = "gen_datos"}
# Prueba de hip√≥tesis de Bartlett


bartlett.test(colesterol ~ factor(dieta), data = datos)
```

## 4. Apliaci√≥n del ANOVA

Ya exploramos los datos y verificamos que se cumplen los supuestos necesarios. Ahora aplicaremos el **ANOVA de una v√≠a** para evaluar si existen diferencias en los niveles de colesterol entre las tres dietas.



##### `r fa("lightbulb", fill = "orange")` Ejemplo 4.1

Usaremos la funci√≥n `aov()` para ajustar el modelo y luego `summary()` para examinar la tabla ANOVA.

```{r ej4_1, exercise=TRUE, exercise.setup = "gen_datos"}
# Ajustar el modelo
modelo <- aov(colesterol ~ dieta, data = datos)

# Resumen del ANOVA
summary(modelo)

```

**¬øC√≥mo interpretar la salida del ANOVA?**

La salida de summary(modelo) incluye:

- Df: Grados de libertad

- Sum Sq: Suma de cuadrados (entre grupos y dentro de los grupos)

- Mean Sq: Media cuadr√°tica (Sum Sq / Df)

- F value: Estad√≠stico F (raz√≥n entre varianza entre y dentro de los grupos)

- Pr(>F): Valor de p


Si el valorde p es menor al nivel de significancia establecido, por ejemplo 0.05, se rechaza la hip√≥tesis nula, lo que indica que al menos una de las medias es significativamente diferente.

üß† Reflexi√≥n : Si el valor de p fue estad√≠sticamente significativo, el siguiente paso ser√≠a identificar cu√°les grupos difieren entre s√≠, lo que se hace con pruebas post-hoc como Tukey HSD. Si no fue significativo, no hay evidencia estad√≠stica suficiente para decir que hay diferencias entre las dietas.

## Pregunta de an√°lisis 4.1

##### `r fa("comments", fill = "#2c5697")` An√°lisis 4.1

üìå Pregunta sobre el estad√≠stico F

```{r quiz_4_1}
quiz(
question("¬øQu√© representa el estad√≠stico F en un ANOVA?",
  answer("La raz√≥n entre la variabilidad entre grupos y dentro de los grupos", correct = TRUE),
  answer("La media de todas las observaciones", correct = FALSE),
  answer("El tama√±o del efecto del grupo m√°s grande", correct = FALSE),
  answer("El coeficiente de regresi√≥n", correct = FALSE),
  allow_retry = TRUE,
  random_answer_order = TRUE)
)
```

## Pregunta de an√°lisis 4.2

##### `r fa("comments", fill = "#2c5697")` An√°lisis 4.2

üìå Pregunta de interpretaci√≥n

```{r quiz_4_2}
quiz(
question("En el contexto del ANOVA, un valor de p menor a alfa (0.05) indica que:",
  answer("Al menos una media grupal es diferente", correct = TRUE),
  answer("Todas las medias son iguales", correct = FALSE),
  answer("Las varianzas son iguales", correct = FALSE),
  answer("La variable dependiente no es normal", correct = FALSE),
  allow_retry = TRUE,
  random_answer_order = TRUE)
)
```


## 5. Pruebas post-hoc y evaluaci√≥n de los residuos

## 5.1 Prueba de Tukey

Si el ANOVA indic√≥ que existe diferencia significativa entre grupos, necesitamos saber **entre qu√© grupos** ocurren esas diferencias. Para ello usamos la prueba **Tukey HSD** (Honest Significant Difference).

##### `r fa("lightbulb", fill = "orange")` Ejemplo 5.1

Usaremos la funci√≥n `TukeyHSD()` para realizar pruebas de hip√≥tesis a posteriori entre los grupos.

```{r ej5_1, exercise=TRUE, exercise.setup = "gen_datos"}
# Ajustar el modelo
modelo <- aov(colesterol ~ dieta, data = datos)

# Prueba post-hoc de Tukey
TukeyHSD(modelo)

```


La salida de TukeyHSD() muestra:

- Comparaciones por pares (ej. B - A, C - A, C - B)

- Diferencia estimada entre medias

- Intervalos de confianza

- Valor de p ajustado (p adj)

Si el p adj es menor al nivel de significancia (en este caso, 0.05), hay diferencia estad√≠sticamente significativa **entre ese par de grupos**.

**En este caso**, se encuentra que existe una diferencia estad√≠sticamente significativa en los niveles promedio de colesterol entre las dietas A y C


## 5.2 Evaluaci√≥n de residuos del modelo

Para comprobar que los supuestos del modelo siguen v√°lidos despu√©s de aplicar ANOVA, analizamos los residuos. Usamos:

- Gr√°fico de residuos vs valores ajustados (homogeneidad)

- Q-Q plot de residuos (normalidad)


##### `r fa("lightbulb", fill = "orange")` Ejemplo 5.2

```{r ej5_2, exercise=TRUE, exercise.setup = "gen_datos"}
# Ajustar el modelo
modelo <- aov(colesterol ~ dieta, data = datos)

# Gr√°ficos de diagn√≥stico
par(mfrow = c(1, 2))  # Mostrar dos gr√°ficos lado a lado
plot(modelo, which = 1)  # Residuos vs ajustados
plot(modelo, which = 2)  # Q-Q plot de residuos

```


üß† Interpretaci√≥n:

- En el primer gr√°fico (panel izquierda), los residuos deber√≠an estar dispersos aleatoriamente (sin patr√≥n), en otro caso ser√≠a cuestionable la homogeneidad

- En el gr√°fio de la derecha, el Q-Q plot, los residuos deber√≠an seguir la l√≠nea diagonal, grandes desviaciones har√≠an cuestionable el supuesto de normalidad




